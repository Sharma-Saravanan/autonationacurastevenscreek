"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toArray(e){return Array.isArray(e)?e:Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),PhoneSwapping=function(){function e(){_classCallCheck(this,e),this.DEPT_WILD_CARD="*",this.cleanRegex=/[\(\)\s\.+-]/gi,this.phoneMetaParamRegex=/(?:dept=)([^&]*)&(?:accountId=)([^&]*)/,this.defaultCleanCapturingRegEx=/^(\d{3})(\d{3})(\d{4})$/,this.defaultReplacementFormat="$1-$2-$3",this.parensReplacementFormat="($1) $2-$3",this.dotReplacementFormat="$1.$2.$3",this.compiledPhoneRegEx=new RegExp(/((?:(?:\+){1}?(?:[\s-.]{1})?)?(?:(?:\d{7,11})|(?:\(?:?(?:\d{3})\)?(?:[\s-.])?(?:\d{3})(?:[\s-.])?(?:\d{4}))))(?:\?([^\s]*))?/gm),this.compiledLinkPhoneRegex=new RegExp(/(?:tel:)(?:\d{1})?((?:\d{3})(?:[\s-.])?(?:\d{3})(?:[\s-.])?(?:\d{4}))(?:\?([^\s]*))?/),this.urlParams=new URLSearchParams(window.location.search),this.ddcref=this.urlParams.get("ddcref")||sessionStorage.getItem("ddcref"),this.tcdcmpid=this.urlParams.get("tcdcmpid")||sessionStorage.getItem("tcdcmpid"),this.artifactOverride=this.urlParams.get("artifactOverride")||this.getCookieValue("phoneSwappingArtifact"),this.root=document.body,this.head=document.head,this.newrelic=window.newrelic,this.excludedAttributes=["vin","src","uuid","fragmentId","slideId"],this.allAccounts=[],this.waitCount=0,this.waitLimit=15,this.waitCountAutoId=0,this.waitLimitAutoId=30,this.errorCount={},this.errorLimit=3,this.lookupCache={},this.numberArtifact={},this.insertedNodes=[],this.deptDestinationNumbers={},this.thirdPartyTrackingConfig=DDC.callTrackingSettings.thirdPartyPhoneTrackingConfiguration,this.metrics={requestsMade:0,numbersSwapped:0},this.tcdcmpid&&this.tcdcmpid.indexOf("&")>-1&&(this.newrelic.setCustomAttribute("tcdCampaignIdInvalid",this.tcdcmpid),this.tcdcmpid=this.tcdcmpid.substring(0,this.tcdcmpid.indexOf("&"))),this.newrelic&&this.tcdcmpid&&this.newrelic.setCustomAttribute("tcdCampaignId",this.tcdcmpid);var t=[],r=DDC.callTrackingSettings.callTrackingAccountIdsOverride||[];if(this.thirdPartyTrackingConfig)t=[DDC.siteSettings.accountId],this.loggingContext="PHONESWAPPING:THIRD PARTY ("+this.thirdPartyTrackingConfig.name+")";else{var a=DDC.siteSettings.childAccountIds||[];t=[DDC.siteSettings.accountId].concat(r.length<1?_toConsumableArray(a):_toConsumableArray(r)),this.loggingContext="PHONESWAPPING:DDC"}this.accountArtifactsToLoad=t.filter(function(e,t,r){return r.indexOf(e)===t}),this.platform=DDC.client.isMobile?"DDC_MOBILE":"DDC_PRIMARY_WEBSITE",this.log("Phone Swapping platform: "+this.platform),this.DDC_DEPT_CONVENTION={"COMPANY PHONE 2":"CUSTOM1","COMPANY PHONE 3":"CUSTOM2"},this.DDC_ONSITE_CONVENTION={CUSTOM1:"SERVICE",CUSTOM2:"PARTS"},this.logIfFound(this.tcdcmpid,"Found TCD campaign ID: "+this.tcdcmpid),this.logIfFound(this.ddcref,"Found ddcref campaign ID: "+this.ddcref),this.logIfFound(this.artifactOverride,"Phone Swapping Artifact Override JSON: "+this.artifactOverride)}return _createClass(e,[{key:"init",value:function(e){var t=this;if(this.numberArtifact){var r=performance.now();this.mergePhoneArtifacts(),this.domTraverse(this.root,this.swapNumbers),this.domTraverse(this.head,this.swapNumbers);var a=performance.now(),i=(a-r).toFixed(2),n=(a-e).toFixed(2);this.trackPerformance("DOM PARSE",i),this.trackPerformance("TOTAL TIME ELAPSED",n),"loading"===document.readyState?window.addEventListener("DOMContentLoaded",function(){return t.onReady()}):this.onReady(),window.addEventListener("wsInvListingShown",function(e){var r=e.detail.id,a=document.getElementById("[data-uuid="+r+"]");t.domTraverse(a,t.swapNumbers)})}}},{key:"onReady",value:function(){this.log("document readyState:",document.readyState),this.domTraverse(this.root,this.swapNumbers),this.domTraverse(this.head,this.swapNumbers),this.observeDOM.call(this,document.getElementsByTagName("body")[0],this.observedNodeTraverse)}},{key:"initIfReady",value:function(e){var t=this.accountArtifactsToLoad.length>1,r=Object.keys(this.loadedAccountArtifacts).length;(!t||r>0)&&(this.trackPerformance("TOTAL ARTIFACT REQUESTS",(performance.now()-e).toFixed(2)),this.init(e))}},{key:"observedNodeTraverse",value:function(e,t){t&&(t.forEach(function(t){e.log("Checking updated dom nodes for additional phone numbers"),e.domTraverse(t,e.swapNumbers)}),e.insertedNodes=[])}},{key:"observeDOM",value:function(e,t){var r=window.MutationObserver||window.WebKitMutationObserver,a=this;if(r){var i=new r(function(e){e[0].addedNodes.length&&e.forEach(function(e){for(var t=0;t<e.addedNodes.length;t++)a.insertedNodes.push(e.addedNodes[t])}),t(a,a.insertedNodes)});i.observe(e,{childList:!0,subtree:!0})}}},{key:"domTraverse",value:function(e,t){for(e||(e=document.body),t.call(this,e),e&&(e=e.firstChild);e;){var r="SCRIPT"===e.tagName&&e.getAttribute&&e.getAttribute("src"),a="LINK"===e.tagName||"STYLE"===e.tagName;r||a||this.domTraverse(e,t),e=e.nextSibling}}},{key:"cleanNumber",value:function(e){return e.replace(this.cleanRegex,"")}},{key:"swapNumbers",value:function(e){var t=e||this.root;this.numberArtifact?this.swapPhoneOnNode(t):this.waitCount<this.waitLimit&&(this.waitCount++,setTimeout(this.swapNumbers,100))}},{key:"swapPhoneOnNode",value:function(e){if(e){var t=void 0,r=void 0;switch(e.hasAttribute&&e.hasAttribute("data-phone-ref")&&(t=e.getAttribute("data-phone-ref"),r=e.getAttribute("data-account-ref")),e.dataset&&this.swapDataAttributeNumber(e,t,r),e.nodeName){case"#text":this.swapTextNodeNumber(e,t,r);break;case"A":this.swapLinkNodeNumber(e,t,r);break;case"META":this.swapMetaNodeNumber(e,t,r)}}}},{key:"swapDataAttributeNumber",value:function(e,t,r){var a=this;if(e.dataset){var i=t,n=r;if(!i&&!n){var o=this.getReplacementMetaDataFromNode(e);i=o[0],n=o[1]}Object.keys(e.dataset).forEach(function(t){var r=e.dataset[t],o=a.compiledPhoneRegEx.exec(r);if(o&&o[0]&&a.validPhoneAttr(t)){var s=o[0],c=o[1],u=o[2];if(u&&a.phoneMetaParamRegex.test(u)){var d=a.phoneMetaParamRegex.exec(u);i=d[1],n=d[2]}var l=a.getNumber(c,i,n);if(l){var h=a.formatReplacementNumber(l);a.logNumberSwap("DATA",s,c,i,n,h),e.dataset[t]=r.replace(s,h)}else e.dataset[t]=r.replace(s,c)}})}}},{key:"swapMetaNodeNumber",value:function(e,t,r){if(e&&e.content&&e.content.length>0){for(var a=void 0,i=t,n=r,o=e.content;null!==(a=this.compiledPhoneRegEx.exec(e.content));){var s=a[0],c=a[1],u=this.getNumber(c,i);if(u){var d=this.formatReplacementNumber(u);this.logNumberSwap("META",s,c,i,n,d),o=o.replace(new RegExp(s,"g"),d)}}e.content=o}}},{key:"swapTextNodeNumber",value:function(e,t,r){if(e&&e.nodeValue&&e.nodeValue.length>0)for(var a=void 0;null!==(a=this.compiledPhoneRegEx.exec(e.data));){var i=t,n=r;if(!i&&!n){var o=this.getReplacementMetaDataFromNode(e);i=o[0],n=o[1]}var s=a[0],c=a[1],u=a[2];if(u&&this.phoneMetaParamRegex.test(u)){var d=this.phoneMetaParamRegex.exec(u);i=d[1],n=d[2]}var l=this.getNumber(c,i,n);if(l){var h=this.formatReplacementNumber(l);this.logNumberSwap("TEXT",s,c,i,n,h),e.nodeValue=e.nodeValue.replace(s,h);var m=e.parentNode;m&&m.hasAttribute("data-phone-ref")&&(m.replaceWith?m.replaceWith(e):m.parentNode.replaceChild(e,m))}}}},{key:"swapLinkNodeNumber",value:function(e,t,r){var a=this.compiledLinkPhoneRegex.exec(e.href);if(a&&a[0]){var i=t,n=r,o=a[0],s=a[1],c=a[2];if(!i&&!n){var u=this.getReplacementMetaDataFromNode(e);i=u[0],n=u[1]}if(c&&this.phoneMetaParamRegex.test(c)){var d=this.phoneMetaParamRegex.exec(c);i=d[1],n=d[2]}var l=this.getNumber(s,i,n);l?(this.logNumberSwap("LINK",o,s,i,n,l),e.href="tel:"+l.replace(/\s*/gi,"")):(e.href="tel:"+s.replace(/\s*/gi,""),e.setAttribute("data-phone-ref",i),e.setAttribute("data-account-ref",n))}}},{key:"getCategorizedTrackingData",value:function(e,t,r,a){return e.find(function(e){return e.isTrackingNumber?r?a?e.trackingCategory===r&&e.trackingId===a:e.trackingCategory===r:e.trackingCategory===t:!1})}},{key:"validPhoneAttr",value:function(e){return!this.excludedAttributes.includes(e)}},{key:"getDeptForDDCCategory",value:function(e,t){if(e.indexOf("COMPANY PHONE 2")>-1){if("DDC_MOBILE"===t)return"SERVICE";if("DDC_PRIMARY_WEBSITE"===t)return"CUSTOM1"}else if(e.indexOf("COMPANY PHONE 3")>-1){if("DDC_MOBILE"===t)return"PARTS";if("DDC_PRIMARY_WEBSITE"===t)return"CUSTOM2"}else if(1===e.length)return e[0]}},{key:"getReplacementNumberArtifacts",value:function(e,t,r){var a=[];return e[t]&&(e[t][r]&&(a=[].concat(_toConsumableArray(e[t][r]))),this.DDC_ONSITE_CONVENTION[r]&&e[t][this.DDC_ONSITE_CONVENTION[r]]&&(a=[].concat(_toConsumableArray(a),_toConsumableArray(e[t][this.DDC_ONSITE_CONVENTION[r]]))),e[t][this.DEPT_WILD_CARD]&&(a=[].concat(_toConsumableArray(a),_toConsumableArray(e[t][this.DEPT_WILD_CARD])))),a}},{key:"phoneNumberOnPageToAccountDept",value:function(e,t){var r=null,a=null,i=e[t],n=!0,o=!1,s=void 0;try{for(var c,u=Object.keys(i)[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var d=c.value,l=i[d];if(this.tcdcmpid){var h=!0,m=!1,f=void 0;try{for(var p,g=l[Symbol.iterator]();!(h=(p=g.next()).done);h=!0){var b=p.value,v=this.getReplacementNumberArtifacts(this.numberArtifact,d,b);if(v){r=b,a=d;break}}}catch(N){m=!0,f=N}finally{try{!h&&g.return&&g.return()}finally{if(m)throw f}}}else{var C=this.getDeptForDDCCategory(l,this.platform),A=this.getReplacementNumberArtifacts(this.numberArtifact,d,C);if(A){r=C,a=d;break}var D=!0,y=!1,w=void 0;try{for(var k,T=l[Symbol.iterator]();!(D=(k=T.next()).done);D=!0){var P=k.value,S=P,O=this.DDC_DEPT_CONVENTION[P]||this.DDC_DEPT_CONVENTION[P.toUpperCase()];S=O?O:P;var E=this.getReplacementNumberArtifacts(this.numberArtifact,d,S);if(E){r=S,a=d;break}}}catch(N){y=!0,w=N}finally{try{!D&&T.return&&T.return()}finally{if(y)throw w}}}}}catch(N){o=!0,s=N}finally{try{!n&&u.return&&u.return()}finally{if(o)throw s}}return[a,r]}},{key:"getReplacementMetaDataFromNode",value:function(e){if(!e)return[];for(var t=e,r=void 0,a=void 0,i=0,n=t.hasAttribute&&t.hasAttribute("data-phone-ref");!n&&t&&t!==document.body&&3>i;)t=t.parentNode,n=t&&t.hasAttribute&&t.hasAttribute("data-phone-ref"),i++;return t&&t.getAttribute&&(r=t.getAttribute("data-phone-ref"),a=t.getAttribute("data-account-ref")),[r,a]}},{key:"getReplacementTrackingData",value:function(e,t){var r=null,a=t[1];return e&&(this.tcdcmpid&&("DDC_MOBILE"===this.platform&&"SALES"===a&&(r=this.getCategorizedTrackingData(e,this.platform,"MOBILE_AD",this.tcdcmpid)),r||(r=this.getCategorizedTrackingData(e,this.platform,"TCD",this.tcdcmpid))),!r&&this.ddcref&&(r=this.getCategorizedTrackingData(e,this.platform,"CAMPAIGN",this.ddcref)),r||(r=this.getCategorizedTrackingData(e,this.platform,this.platform))),r}},{key:"getNumber",value:function(e,t,r){var a=this;if(!e||!r)return!1;var i="DDC_MOBILE"===this.platform?"MOBILE_AD":"TCD",n=this.cleanNumber(e).replace("tel:","");this.log("Clean lookup number from cleanNumber: "+n+" and account: "+r);var o="";if(!t||!r)return null;o=n+"_"+t+"_"+r,this.log("Lookup key: "+o+" and current cache, checking index for already swapped: "+Object.values(this.lookupCache).indexOf(o),this.lookupCache);var s=-1!==Object.values(this.lookupCache).indexOf(o);if(this.log("Account "+r+", already swapped: "+s),s)return null;if(!this.lookupCache[o]&&(this.lookupCache[o]=this.lookupNumber(n,t,r),this.tcdcmpid&&Object.keys(this.allAccounts).length)){var c=this.allAccounts.filter(function(e){return e.account===r});this.log("For "+r+" found "+(c.length>0?c.length:0)+" results"),c.forEach(function(e){var r=e.phones.filter(function(e){return e.trackingId===a.tcdcmpid&&e.profitCenter===t&&e.trackingCategory===i});if(r.length)a.log("Results in phone swap array matching "+a.tcdcmpid+" "+t,r),a.lookupCache[o]=r[0].number;else{var n=a.allAccounts.filter(function(e){return e.account===window.DDC.siteProperties.topLevelPhoneSwappingAccount});if(a.log("Using top level account for number: "+JSON.stringify(n)),n.length){var s=n[0].phones.filter(function(e){return e.trackingId===a.tcdcmpid&&e.profitCenter===t&&e.trackingCategory===i});s.length&&(a.log("Top level account after filters: "+JSON.stringify(s)),a.lookupCache[o]=s[0].number)}}})}return this.lookupCache[o]}},{key:"lookupNumber",value:function(e,t,r){var a=null;if(11===e.length){var i=e,n=_toArray(i);a=n[0],e=n.slice(1)}var o=[r,t];if(!o[0]||!o[1]){var s=this.deptDestinationNumbers[e];if(s){var c=this.phoneNumberOnPageToAccountDept(this.deptDestinationNumbers,e);o[0]=o[0]||c[0],o[1]=o[1]||c[1]}}var u=this.getReplacementNumberArtifacts(this.numberArtifact,o[0],o[1]),d=this.getReplacementTrackingData(u,o),l=d?d.number:null;return l&&a?a+" "+l:(this.log("Replacement number from lookupNumber: "+l),l)}},{key:"formatReplacementNumber",value:function(e){var t=void 0,r=this.defaultReplacementFormat;switch(DDC.siteProperties.phoneNumberFormat){case"parentheses":r=this.parensReplacementFormat;break;case"dot":r=this.dotReplacementFormat;break;default:r=this.defaultReplacementFormat}return e&&e===this.cleanNumber(e)&&(t=e.replace(this.defaultCleanCapturingRegEx,r)),t?t:e}},{key:"loadNumbers",value:function(e,t){var r=this,a=t?t:performance.now();if(this.artifactOverride){var i=JSON.parse(this.artifactOverride);this.fillDeptToDestMap(e,i.phones),this.log("Using Artifact Override: "+(performance.now()-a).toFixed(2)+" ms."),this.init(a)}else if(this.thirdPartyTrackingConfig){var n=this.thirdPartyTrackingConfig,o=n.url,s=n.apiKey,c=n.username,u=n.password,d=n.accountId,l=performance.now();this.metrics.requestsMade+=1;var h=new XMLHttpRequest;h.open("POST",o,!0),h.onreadystatechange=function(){var r=this;if(4===h.readyState){var i=h.status;if(200===i){var n=(performance.now()-l).toFixed(2);n>500&&this.trackPerformance("ARTIFACT REQUEST SLOW",n),this.loadedAccountArtifacts[e]=!0;var o=JSON.parse(h.responseText).map(function(e){return{number:e.number,isTrackingNumber:!0,trackingCategory:r.platform,locationOnSite:r.DEPT_WILD_CARD}});this.fillDeptToDestMap(e,o,!1),this.initIfReady(a)}else i>=400&&500>i?this.handleNumberLoadFail.apply(this,[e,t,i]):i>=500&&this.handleNumberLoadError.apply(this,[e,t,i]);this.newrelic&&this.newrelic.setCustomAttribute("phoneSwapStatus",i)}}.bind(this),h.send(this.generateThirdPartyPostBody("jsonString",c,u,s,d))}else{var m=performance.now();this.metrics.requestsMade+=1;var f=new XMLHttpRequest;f.open("GET",DDC.callTrackingSettings.callTrackingArtifactBaseUrl+"/"+e+".json",!0),f.onload=function(){if(200===f.status){var i=JSON.parse(f.responseText);r.fillDeptToDestMap(e,i.phones),r.loadedAccountArtifacts[e]=!0;var n=(performance.now()-m).toFixed(2);n>500&&r.trackPerformance("ARTIFACT REQUEST SLOW",n),r.initIfReady(a)}else r.handleNumberLoadError.apply(r,[e,t,f.status])},f.onerror=function(){f.status>=500?r.handleNumberLoadError.apply(r,[e,t,status]):r.handleNumberLoadFail.apply(r,[e,t,status])},f.send()}}},{key:"loadNumbersFromService",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:performance.now(),a=new URL(window.DDC.phonesUrl);if(a.searchParams.append("accounts",e.join(",")),a.searchParams.append("platform",this.platform),this.tcdcmpid&&a.searchParams.append("tcdcmpid",this.tcdcmpid),this.ddcref&&a.searchParams.append("ddcref",this.ddcref),this.metrics.requestsMade+=1,this.newrelic){var i=window.DDC.phonesUrl.includes("phone-swap-service-v2")?"v2":"v1";this.newrelic.setCustomAttribute("phoneSwapServiceVersion",i)}this.isAutoIdIntegration()&&this.waitCountAutoId<this.waitLimitAutoId?window.autoid_inited?e.forEach(function(e){t.loadNumbersFromAutoId(e,window.phoneNumbers,r)}):(this.waitCountAutoId++,setTimeout(function(){return t.loadNumbersFromService(e,r)},100)):fetch(a).then(function(e){return e.json()}).then(function(e){t.allAccounts=e,e.forEach(function(e){var a=e.account,i=e.phones;t.fillDeptToDestMap(a,i),t.loadedAccountArtifacts[a]=!0,t.initIfReady(r)})}).catch(function(a){return e.forEach(function(e){return t.handleNumberLoadFail(e,r,a)})})}},{key:"isAutoIdIntegration",value:function(){return window.DDC.enableCallsourcePhoneSwapping&&window.aiGetNumbers&&!this.tcdcmpid}},{key:"loadNumbersFromAutoId",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments[2],i=[],n=r.map(function(e){return t.cleanNumber(e)});window.aiGetNumbers(n,function(r,n){r?t.handleNumberLoadFail(e,a,r):0===Object.keys(n).length?t.handleNumberLoadFail(account,a,"[aiGetNumbers] no results."):(Object.keys(n).forEach(function(e){Object.keys(n[e]).forEach(function(r){var a={number:""+n[e][r],isTrackingNumber:!0,department:e.toUpperCase(),locationOnSite:e.toUpperCase(),trackingCategory:t.platform,profitCenter:e.toUpperCase()};i.push(a)})}),t.allAccounts.push({account:e,phones:i}),t.fillDeptToDestMap(e,i),t.loadedAccountArtifacts[e]=!0,t.initIfReady(a))})}},{key:"loadAllNumbers",value:function(){var e=performance.now();if(this.loadedAccountArtifacts={},this.thirdPartyTrackingConfig){var t=this.accountArtifactsToLoad[0];this.loadNumbers(t,e,this.thirdPartyTrackingConfig)}else this.loadNumbersFromService.bind(this,this.accountArtifactsToLoad,e)()}},{key:"fillDeptToDestMap",value:function(e,t){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;t.forEach(function(t){a===!0&&(r.deptDestinationNumbers[r.cleanNumber(t.number)]?(r.deptDestinationNumbers[r.cleanNumber(t.number)][e]||(r.deptDestinationNumbers[r.cleanNumber(t.number)][e]=[]),r.deptDestinationNumbers[r.cleanNumber(t.number)][e].push(t.department&&t.department.toUpperCase())):(r.deptDestinationNumbers[r.cleanNumber(t.number)]=_defineProperty({},e,[]),r.deptDestinationNumbers[r.cleanNumber(t.number)][e].push(t.department&&t.department.toUpperCase()))),t.isTrackingNumber===!0&&r.fillPhoneArtifact(e,t)})}},{key:"fillPhoneArtifact",value:function(e,t){this.numberArtifact[e]?(this.numberArtifact[e][t.locationOnSite]=this.numberArtifact[e][t.locationOnSite]||[],this.numberArtifact[e][t.locationOnSite].push(t)):this.numberArtifact[e]=_defineProperty({},t.locationOnSite,[t])}},{key:"mergePhoneArtifacts",value:function(){var e=this;DDC.siteProperties&&DDC.siteProperties.callTrackingRollupNumbersToAccount===!0&&DDC.callTrackingSettings.callTrackingAccountIdsOverride.filter(function(e){return e!==DDC.siteSettings.accountId}).forEach(function(t){void 0!==e.numberArtifact[t]&&Object.keys(e.numberArtifact[t]).forEach(function(r){void 0!==e.numberArtifact[DDC.siteSettings.accountId]&&(void 0===e.numberArtifact[DDC.siteSettings.accountId][r]&&(e.numberArtifact[DDC.siteSettings.accountId][r]=[]),e.numberArtifact[DDC.siteSettings.accountId][r]=[].concat(_toConsumableArray(e.numberArtifact[DDC.siteSettings.accountId][r].concat(e.numberArtifact[t][r]))))})})}},{key:"handleNumberLoadError",value:function(e,t,r){if(this.errorCount[e]=this.errorCount[e]||0,this.errorCount[e]++<this.errorLimit){var a="ARTIFACT REQUEST ERROR "+(r?" - "+r:"");this.log(a),this.trackPerformance(a,(performance.now()-t).toFixed(2)),this.loadNumbers(e,t)}else this.handleNumberLoadFail(e,t,null,"error limit")}},{key:"handleNumberLoadFail",value:function(e,t,r){var a="ARTIFACT REQUEST FAILED "+(r?" - "+r:"");this.loadedAccountArtifacts[e]=!1,this.initIfReady(t),this.trackPerformance(a,(performance.now()-t).toFixed(2)),this.log("NUMBERS NOT SWAPPED FOR "+e)}},{key:"getCookieValue",value:function(e){var t=new RegExp(e+"=(.*?)(;|$)").exec(document.cookie);return t?t[1]:null}},{key:"logIfFound",value:function(e,t){e&&this.log(t)}},{key:"log",value:function(){return window.location.search.indexOf("_phoneswappingdebug=true")>0&&window.console?void window.console.log.apply(this,arguments):(this.log=function(){},null)}},{key:"logNumberSwap",value:function(e,t,r,a,i,n){this.metrics.numbersSwapped+=1,this.newrelic&&this.newrelic.setCustomAttribute("phoneNumbersSwapped",this.metrics.numbersSwapped),this.log("SWAPPING NUMBER "+e+":"),this.log("Found Swappable Content: "+t);var o=i&&a?"for "+i+"-"+a:" first found ";this.log(r+" "+o+" with "+n)}},{key:"trackPerformance",value:function(e,t){this.log(e+" took "+t+"ms."),this.newrelic&&this.newrelic.addPageAction("phoneSwapping",{loggingContext:this.loggingContext,action:e,duration:t?parseFloat(t):0})}},{key:"generateThirdPartyPostBody",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json",t=arguments[1],r=arguments[2],a=arguments[3],i=arguments[4],n={api:a,username:t,password:r,site_id:parseInt(i),external_id:DDC.callTrackingSettings.callTrackingSessionId,currentPage:document.location.href,defaultPage:DDC.siteSettings.defaultDomain,defaultDomain:DDC.siteSettings.defaultDomain,cookies:{utmz:this.getCookieValue("__utmz"),utma:this.getCookieValue("__utma")}};return document.referrer&&(n.previousPage=encodeURIComponent(document.referrer)),"jsonString"===e?JSON.stringify(n):"json"===e?n:void 0}}]),e}(),phoneSwapping=new PhoneSwapping;phoneSwapping.loadAllNumbers();