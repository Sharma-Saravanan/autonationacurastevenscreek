!function(e){"use strict";var r=window.DDC=window.DDC||{};r.userProfileController=window.DDC.userProfileController=window.DDC.userProfileController||{},r.userProfile={};var i={firstName:'[name="contact.firstName"]',lastName:'[name="contact.lastName"]',email:'[name="contact.email"]',phone:'[name="contact.phone"]',preferred:'[name="contact.preferredContact"] [value="phone"]',postalCode:'[name="contact.address.postalCode"]'},o=r.siteProperties.enableConsolidatedLeadForms,l="drUserSession";const t=JSON.parse(r.session.get(l));t&&t.ePriceVehicles&&(r.userProfile.ePriceVehicles=t.ePriceVehicles);var s=r&&r.pubsub;r.userProfileController.hasUserContactData=function(e){return e=e||!1,r.userProfile.firstName&&r.userProfile.lastName&&(e?r.userProfile.email:r.userProfile.email||r.userProfile.phone)?!0:!1},r.userProfileController.fillContactForm=function(e){return r.userProfile&&e&&(e.find(i.firstName).val(r.userProfile.firstName),e.find(i.lastName).val(r.userProfile.lastName),e.find(i.email).val(r.userProfile.email),e.find(i.phone).val(r.userProfile.phone),e.find(i.postalCode).val(r.userProfile.postalCode),r.userProfileController.hasUserContactData())?(r.userProfile.email||e.find(i.preferred).attr("selected","selected").closest(":input").trigger("change"),!0):!1},r.userProfileController.populateProfileFormFields=function(e){r.userProfile&&e&&o&&(r.userProfile.firstName=e.find(i.firstName).val(),r.userProfile.lastName=e.find(i.lastName).val(),r.userProfile.email=e.find(i.email).val(),r.userProfile.phone=e.find(i.phone).val(),r.userProfile.postalCode=e.find(i.postalCode).val()||"")},r.userProfileController.sendLeadForm=function(i){i&&e.ajax({url:i,type:"get",dataType:"html"}).then(function(i){var o=e(i).find('form[data-form-tracking-id="INSTANT_EPRICE"]');r.userProfileController.fillContactForm(o),e.ajax({url:o.attr("action"),type:"post",dataType:"html",data:o.serialize()})})},r.userProfileController.saveInstantEpriceVehicle=function(e,i){r.userProfileController.populateProfileFormFields(e);var o={itemUUID:i};r.userProfile.ePriceVehicles||(r.userProfile.ePriceVehicles=[],s&&window.DDC.pubsub.publish("ePrice-created")),r.userProfile.ePriceVehicles.filter(function(e){return e.itemUUID===i}).length>0||(r.userProfile.ePriceVehicles.push(o),r.userProfileController.saveProfile(o))},r.userProfileController.saveProfile=function(i,o,t){t="undefined"==typeof t?!0:t,e.extend(!0,r.userProfile,i),r.session.set(l,JSON.stringify(r.userProfile)),t&&(e.publish("ePrice-updated"),s&&window.DDC.pubsub.publish("ePrice-updated")),o&&o.call()},window.DDC.pubsub.subscribe("ePrice-created",function(){jQuery(".instantEPriceButton button").click(function(){window.DDC.userProfile&&window.DDC.userProfile.ePriceVehicles&&window.DDC.userProfile.ePriceVehicles.length>0&&r.userProfileController.saveInstantEpriceVehicle(null,e(this).attr("data-vehicle-uuid"))})})}(jQuery);