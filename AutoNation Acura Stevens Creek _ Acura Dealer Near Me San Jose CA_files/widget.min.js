"use strict";!function(e,t,a){var n=function(e){var t=[],n=function(e){return t.indexOf(e)>-1};this.callFunc=function(i,r){if(!n(r)){var o=(new Date).getTime(),d=i.eventData?i.eventData:i;e(d),a&&a.addPageAction("dataLayerEventListener",{event:i.event,duration:(new Date).getTime()-o,widgetName:i.widgetName||"",action:i.action||""}),t.push(r)}}},i=function(){var e={},a=void 0,i=void 0,r=function(t){var a=window.dataLayer.indexOf(t),n=e[t.event];if(n&&n.length)for(var i=0;i<n.length;i++)n[i].callFunc(t,a)},o=function(e){return"undefined"!=typeof i?i:(i=!1,"undefined"==typeof e?(t.log("error","DDC DataLayer Event System - window.dataLayer is undefined, event listening disabled"),i):"undefined"==typeof DataLayerHelper?(t.log("error","DDC DataLayer Event System - DataLayerHelper is undefined, event listening disabled"),i):i=!0)},d=function(e){if(o(window.dataLayer))for(var t=0;t<window.dataLayer.length;t++){var a=window.dataLayer[t];"undefined"!=typeof a.event&&a.event===e&&r(a)}},s=function(e){return new DataLayerHelper(e,function(e,t){r(t)},!0)};this.initialize=function(e){"undefined"==typeof a&&o(e)&&(a=s(e),t.log("info","DDC DataLayer Event System - Initialized"))},this.listen=function(a,i){e[a]||(e[a]=[]),"function"==typeof i&&(e[a].push(new n(i)),d(a),t.log("info","DDC DataLayer Event System - Listener added for "+a+"."))},"undefined"!=typeof __karma__&&(this.reset=function(t){e={},i=void 0,a=t?void 0:s(window.dataLayer)})};t.classes.namespace("dataLayer.events",t),t.dataLayer.events.listener=new i,e(function(){var a=e("body");t.dataLayer.client.browser=navigator.appCodeName,t.dataLayer.client.browserVersion=navigator.appVersion,t.dataLayer.client.browserUser=navigator.userAgent,t.dataLayer.client.browserPlatform=navigator.platform,t.dataLayer.client.pixelResolution=screen.pixelDepth,t.dataLayer.client.screenWidth=screen.width,t.dataLayer.client.screenHeight=screen.height;var n=new Date,i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=n.getUTCDate(),o=n.getUTCFullYear(),d=n.getUTCMonth()+1;if(9>=d&&(d="0"+d),9>=r&&(r="0"+r),Date.prototype.getHoursTwoDigits=function(){var e=this.getHours();return 10>e?"0"+e.toString():e.toString()},Date.prototype.getMinutesTwoDigits=function(){var e=this.getMinutes();return 10>e?"0"+e.toString():e.toString()},Date.prototype.getSecondsTwoDigits=function(){var e=this.getSeconds();return 10>e?"0"+e.toString():e.toString()},t.dataLayer.date.currentTime=n,t.dataLayer.date.date=o+"-"+d+"-"+r,t.dataLayer.date.dayOfWeek=i[n.getDay()],t.dataLayer.date.time=n.getHoursTwoDigits()+":"+n.getMinutesTwoDigits()+":"+n.getSecondsTwoDigits(),t.dataLayer.date.timeZoneOffSet=n.getTimezoneOffset(),t.dataLayer.page.attributes.specialsCountPerCategory=e(".ddc-content.special").length,t.dataLayer.site.features.promotions.enabled){var s=a.find("[data-promo-id]"),u=function(){var a=["accountId="+t.siteSettings.accountId];return s.each(function(){a.push("promotionId="+e(this).data("promoId"))}),_.uniq(a).join("&")},y=function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];for(var n in a)!a.hasOwnProperty(n)||""!==a[n]&&null!==a[n]||(a[n]=void 0)}return e},c=t.addUrlParams(t.getWindowOrigin()+"/apis/promotions",u());s.length>0&&(t.classes.namespace("dataLayer.page.attributes.promotions",t),e.get(c,function(e){t.dataLayer.page.attributes.promotions=y(e)}))}t.dataLayer.events.listener.initialize(window.dataLayer)})}(jQuery,window.DDC,window.newrelic);